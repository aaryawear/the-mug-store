<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Secure Checkout</title>

<style>
body {
  margin: 0;
  background: #f8fafc;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  color: #111827;
}
header {
  background: #000;
  color: #fff;
  padding: 12px;
  text-align: center;
  font-size: 13px;
}
.wrap {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}
.card {
  background: #fff;
  border-radius: 16px;
  padding: 22px;
  box-shadow: 0 10px 30px rgba(0,0,0,.06);
}
h1 { font-size: 22px; }
.order { font-size: 13px; color: #6b7280; }
.summary {
  background: #f9fafb;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 18px;
}
.price { font-size: 20px; font-weight: 700; }
input {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  margin-bottom: 10px;
}
button {
  width: 100%;
  padding: 16px;
  border-radius: 14px;
  border: none;
  background: #000;
  color: #fff;
  font-weight: 700;
  font-size: 16px;
}
button:disabled { opacity: .6; }
.status {
  text-align: center;
  font-size: 14px;
  margin-top: 10px;
}
.loader {
  margin: 12px auto;
  border: 4px solid #e5e7eb;
  border-top: 4px solid #000;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  animation: spin 1s linear infinite;
}
@keyframes spin {100%{transform:rotate(360deg)}}
footer {
  text-align: center;
  font-size: 12px;
  color: #6b7280;
  padding: 16px;
}
</style>
</head>

<body>

<header>ðŸ”’ Secure Checkout â€¢ Prepaid Only</header>

<div class="wrap">
<div class="card">

<h1>Checkout</h1>
<p class="order">Order ID: <b id="orderId"></b></p>

<div class="summary">
  <h3 id="productName"></h3>
  <div class="price">â‚¹<span id="priceText"></span></div>
</div>

<input id="name" placeholder="Full Name *">
<input id="phone" type="tel" pattern="[0-9]{10}" placeholder="Mobile Number *">
<input id="address" placeholder="House / Street / Area *">
<input id="city" placeholder="City *">
<input id="state" placeholder="State *">
<input id="pincode" placeholder="Pincode *">

<button id="payBtn">Pay â‚¹<span id="payAmount"></span></button>

<div id="status" class="status"></div>
<div id="loader" class="loader" style="display:none"></div>

</div>
</div>

<footer>WhatsApp support after order</footer>

<!-- ================= CONFIG (CHANGE PER STORE) ================= -->
<script>
const STORE_NAME = "Kunal Store";
const UPI_ID = "7381749483@okbizaxis";       // change per store
const TELEGRAM_BOT = "8519147037:AAGXDo9ku4iOP6X6F2jQxnME08WwctUjoj0";
const TELEGRAM_CHAT = "5820261983";
</script>

<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAcokjcwR2WEiis__c61TuXEzYXhxUlKB8",
  authDomain: "shop-template-7d574.firebaseapp.com",
  projectId: "shop-template-7d574"
});
const db = firebase.firestore();
</script>

<!-- ================= LOGIC ================= -->
<script>
const params = new URLSearchParams(location.search);
const productName = params.get("product") || "Product";
const amount = params.get("price") || "0";
const orderId = "ORD" + Date.now().toString().slice(-8);

document.getElementById("productName").innerText = productName;
document.getElementById("priceText").innerText = amount;
document.getElementById("payAmount").innerText = amount;
document.getElementById("orderId").innerText = orderId;

const btn = document.getElementById("payBtn");
const statusEl = document.getElementById("status");
const loader = document.getElementById("loader");

/* TELEGRAM */
function sendTelegram(msg) {
  fetch(
    `https://api.telegram.org/bot${TELEGRAM_BOT}/sendMessage?chat_id=${TELEGRAM_CHAT}&text=${encodeURIComponent(msg)}`
  ).catch(()=>{});
}

/* UPI */
function upiLink() {
  return `upi://pay?pa=${UPI_ID}&pn=${encodeURIComponent(STORE_NAME)}&am=${amount}&cu=INR&tn=${orderId}`;
}

btn.onclick = async () => {

  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const city = document.getElementById("city").value.trim();
  const state = document.getElementById("state").value.trim();
  const pincode = document.getElementById("pincode").value.trim();

  if(!name||!phone||!address||!city||!state||!pincode){
    alert("Please fill all fields");
    return;
  }

  btn.disabled = true;
  statusEl.innerText = "Processing paymentâ€¦";
  loader.style.display = "block";

  await db.collection("orders").add({
    orderId,
    product: productName,
    amount: Number(amount),
    customerName: name,
    phone,
    address,
    city,
    state,
    pincode,
    store: STORE_NAME,
    status: "PENDING",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  sendTelegram(
`ðŸ›’ NEW ORDER (${STORE_NAME})
ðŸ†” ${orderId}
ðŸ“¦ ${productName}
ðŸ’° â‚¹${amount}
ðŸ“ž ${phone}`
  );

  /* OPEN UPI IMMEDIATELY */
  location.href = upiLink();

  /* PROCESSING 15s */
  setTimeout(()=>{
    location.href = `success.html?orderId=${orderId}`;
  },15000);
};
</script>

</body>
</html>
